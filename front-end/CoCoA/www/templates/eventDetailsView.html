
<!-- <ion-view data-ng-init="eventDetailsView()" hide-back-button="isEditMode"> -->
<ion-view data-ng-init="eventDetailsView()">

  <ion-nav-buttons id="eventdetail-nav" side="left">
  <ion-nav-back-button class="button-clear backbutton" ng-click="goback()">
    <i class="ion-chevron-left"></i> Back
  </ion-nav-back-button>
    <h1 class="title">{{eventInfo.title}} - Details</h1>
    <a id="edit-btn" class="button button-clear button-positive" ng-click="toggleEventDetailEditMode()" >Edit</a>
  </ion-nav-buttons>
  <ion-content class="squeezed-content">
  <div class="list" id="eventDetailList">

    <div ng-if="isEditMode">
        <label class="item item-input item-stacked-label">
          <div class="row">
            <div class="col col-33"><p class="info-label">Start Date</p></div>
            <div class="col col-67">
              <input type="date" value="eventInfo.startDate" ng-model="eventInfo.startDate">
            </div>
          </div>
        </label>

        <label class="item item-input item-stacked-label">
          <div class="row">
            <div class="col col-33"><p class="info-label">End Date</p></div>
            <div class="col col-67">
              <input type="date" value="eventInfo.endDate" ng-model="eventInfo.endDate">
            </div>
          </div>
        </label>
    </div>

    <label class="item item-input item-stacked-label" ng-if="!isEditMode && (eventInfo.startDate || eventInfo.endDate)">
      <div class="row">
        <div class="col col-33"><p class="info-label">Date</p></div>
        <div class="col col-67">
          <p ng-if="eventInfo.startDate && eventInfo.endDate && eventInfo.isCurrentYear">{{eventInfo.startDate | date: 'MMM dd'}} - {{eventInfo.endDate | date: 'MMM dd'}}</p>
          <p ng-if="eventInfo.startDate && eventInfo.endDate && !eventInfo.isCurrentYear">{{eventInfo.startDate | date: 'MMM dd, yyyy'}} - {{eventInfo.endDate | date: 'MMM dd, yyyy'}}</p>
          <p ng-if="eventInfo.startDate && !eventInfo.endDate && eventInfo.isCurrentYear">{{eventInfo.startDate | date: 'MMM dd'}} </p>
          <p ng-if="eventInfo.startDate && !eventInfo.endDate && !eventInfo.isCurrentYear">{{eventInfo.startDate | date: 'MMM dd, yyyy'}} </p>
          <p ng-if="!eventInfo.startDate && eventInfo.endDate && eventInfo.isCurrentYear">{{eventInfo.endDate} | date: 'MMM dd'} </p>
          <p ng-if="!eventInfo.startDate && eventInfo.endDate && !eventInfo.isCurrentYear">{{eventInfo.endDate} | date: 'MMM dd, yyyy'} </p>
        </div>
      </div>
    </label>

    <label class="item item-input item-stacked-label" ng-show="isEditMode || eventInfo.time">
      <div class="row">
        <div class="col col-33">
          <p class="info-label">Time</p>
        </div>
        <div class="col col-67">
          <input type="time" placeholder="Event Time" ng-show="isEditMode" ng-model="eventInfo.time">
          <p ng-show="!isEditMode">{{eventInfo.time | date:'h:mma'}}</p>
        </div>
      </div>
    </label>

    <label class="item item-input item-stacked-label" ng-show="!isEditMode">
      <div class="row">
        <div class="col col-33">
          <p class="info-label">No. students</p>
        </div>
        <div class="col col-67">
          <input type="time" placeholder="Event Time" ng-show="isEditMode" ng-model="eventInfo.time">
          <p ng-show="!isEditMode">{{eventSelectedParticipants.length}}</p>
        </div>
      </div>
    </label>

    <label class="item item-input item-stacked-label" ng-show="isEditMode || eventInfo.venue">
      <div class="row">
        <div class="col col-33">
          <p class="info-label">Venue</p>
        </div>
        <div class="col col-67">
          <input type="text" placeholder="Event Venue" ng-show="isEditMode" ng-model="eventInfo.venue">
          <p ng-show="!isEditMode">{{eventInfo.venue}}</p>
        </div>
      </div>
    </label>

    <label class="item item-input item-stacked-label" ng-show="isEditMode || eventInfo.studentsNeeded">
      <div class="row">
        <div class="col col-33">
          <p class="info-label">Students</p>
        </div>
        <div class="col col-67">
          <input type="text" placeholder="e.g. 2 Sec 2's & 4 Sec 4's" ng-show="isEditMode" ng-model="eventInfo.studentsNeeded">
          <p ng-show="!isEditMode && eventInfo.studentsNeeded">{{eventInfo.studentsNeeded}}</p>
        </div>
      </div>
    </label>

    <label class="item item-input item-stacked-label" ng-show="isEditMode || eventInfo.reportTime">
      <div class="row">
        <div class="col col-33 item-text-wrap">
          <p class="info-label">Report Time</p>
        </div>
        <div class="col col-67">
          <input type="time" ng-show="isEditMode" placeholder="Reporting time on day of the event" ng-model="eventInfo.reportTime">
          <p ng-show="!isEditMode">{{eventInfo.reportTime}}</p>
        </div>
      </div>
    </label>

<!--     <label class="item item-input item-stacked-label" ng-show="isEditMode || eventInfo.reportVenue">
      <div class="row">
        <div class="col col-33 item-text-wrap">
          <p class="info-label">Report Venue</p>
        </div>
        <div class="col col-67">
          <input type="text" placeholder="Reporting venu on day of the event" ng-show="isEditMode" ng-model="eventInfo.reportVenue">
          <p ng-show="!isEditMode">{{eventInfo.reportVenue}}</p>
        </div>
      </div>
    </label> -->

    <label class="item item-input item-stacked-label" ng-show="isEditMode || eventInfo.TOIC">
      <div class="row">
        <div class="col col-33 item-text-wrap">
          <p class="info-label">Teacher IC</p>
        </div>
        <div class="col col-67">
          <input type="text" placeholder="Teacher In Charge" ng-show="isEditMode" ng-model="eventInfo.TOIC">
          <p ng-show="!isEditMode">{{eventInfo.TOIC}}</p>
        </div>
      </div>
    </label>

    <label class="item item-input item-stacked-label" ng-if="isEditMode">
      <div class="row">
        <div class="col col-33">
          <p class="info-label">Notes</p>
        </div>
        <div class="col col-67">
          <textarea ng-model="eventInfo.comments" value="eventInfo.comments" ng-show="isEditMode" placeholder="Extra notes of the event"></textarea>
        </div>
      </div>
    </label>

    <label class="item item-input item-stacked-label" ng-if="!isEditMode && eventInfo.comments">
      <div class="row">
        <div class="col col-33">Notes</div>
        <div class="col col-67"></div>
      </div>
      <div class="row">
        <p class="col">{{eventInfo.comments}}</p>
      </div>
    </label>

    <label class="item item-input item-stacked-label " ng-if="!isEditMode && !eventInfo.startDate && !eventInfo.endDate && !eventInfo.time && ! eventInfo.venue && !eventInfo.studentsNeeded && !eventInfo.reportTime && !eventInfo.TOIC && !eventInfo.comments">
      <div class="row empty">
        <p><i class="icon ion-ios7-information"></i><span>Click edit to add event details</span></p>
      </div>
    </label>

        <div class="item item-divider thin"></div>
            
        <div class="item participants-divider" ng-if="!isParticipantEditMode">
          participants
          <a class="part-edit-btn right-button icon ion-plus" ng-click="toggleParticipantEditMode(false)"></a>
        </div>
        <div class="item participants-divider" ng-if="isParticipantEditMode">
          <a class="part-edit-btn right-button font" ng-click="toggleParticipantEditMode(true)" >Finish</a>
          Choose participants
        </div>
        <form ng-if="eventSelectedParticipants.length > 0 || isEditMode">
          <label class="item item-input search" >
            <i class='icon ion-search placeholder-icon'></i>
            <input type="text" ng-model="stdNameFilter" placeholder="Search">     
          </input>
          </label>
        </form>
        <label class="item item-input item-stacked-label " ng-if="eventSelectedParticipants.length == 0 && !isEditMode">
          <div class="row empty">
            <p><i class="icon ion-ios7-information"></i><span>Click + to add participants</span></p>
          </div>
        </label>
        <ion-list ng-if="!isParticipantEditMode">
          <div class="item item-divider" ng-repeat-start="(initial, participants) in partViewModel">{{initial}}</div>
          <ion-item class="participants-row" ng-repeat="student in participants track by student.id" ng-if="student.selected && (!stdNameFilter || student.name.toLowerCase().indexOf(stdNameFilter.toLowerCase())) > -1"  ng-click="toggleStuInfoDisplay(student.id)" ng-class="{'highlighted' : selectedRow == student.id}">
            <div class="row">
              <p class="col col-90" ng-class="{'alert' : student.data.medical_concern}">{{student.name}}</p>
            </div>
            <div ng-show="selectedRow == student.id" class="item-animate">
              <br>
                <hr>
                <label><b>Class</b></label>
                <p>{{student.data.class}}</p>
                <hr>
                <label><b>Tel</b></label>
                <p>{{student.data.guardian_contact_phone}}, {{student.data.guardian_contact_mobile}}</p>
                <hr>
                <label><b>Race</b></label>
                <p>{{student.data.race}}</p>
                <hr>
                <label><b>Med Concerns</b></label>
                <p class="alert">{{student.data.medical_concern}}</p>
            </div>
          </ion-item>
          <div ng-repeat-end></div>
        </ion-list>

        <ion-list ng-if="isParticipantEditMode">
          <div class="item item-divider" ng-repeat-start="(initial, participants) in participantsEditModel">{{initial}}</div>
          <ion-item class="participants-row" ng-repeat="student in participants" ng-if="!stdNameFilter || student.name.toLowerCase().indexOf(stdNameFilter.toLowerCase()) > -1"  ng-class="{'highlighted' : selectedRow == student.id}" ng-click="chooseParticipant(student.id)">
            <div class="row">
              <div class="col col-15">
                <i class="icon ion-checkmark-circled"  ng-if="student.selected"></i>
                <i class="icon ion-ios7-circle-outline" ng-if="!student.selected"></i>
              </div>
              <div class="col col-80" ng-class="{'alert' : student.data.medical_concern}">
               {{student.name}}
              </div>
              <div class="col col-5">
               <i class="icon ion-ios7-arrow-forward " ng-click="toggleStuInfoDisplay(student.id)" stop-event></i>
              </div>
            </div>
            <div ng-show="selectedRow == student.id" class="item-animate">
              <br>
                <hr>
                <label><b>Class</b></label>
                <p>{{student.data.class}}</p>
                <hr>
                <label><b>Tel</b></label>
                <p>{{student.data.guardian_contact_phone}}, {{student.data.guardian_contact_mobile}}</p>
                <hr>
                <label><b>Race</b></label>
                <p>{{student.data.race}}</p>
                <hr>
                <label><b>Med Concerns</b></label>
                <p class="alert">{{student.data.medical_concern}}</p>
            </div>
          </ion-item>
          <div ng-repeat-end></div>
        </ion-list>
    </div>
  </ion-content>
        <button menu-toggle="left"  id="menu-toggle" class="button button-icon"><span class="ion-navicon"></span></button>

</ion-view>
